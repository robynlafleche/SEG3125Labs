<html lang="en-US">
<head>
    <title>Airbnb Survey Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
     <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
   <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script> 
</head>

<body>
    <h1 style="padding-left: 36%">Airbnb survey analysis</h1>
    <% for (var surveyQuestionResult in allSurveyResults){ %>
      <script>
        var clientGameState =  allSurveyResults       
     </script>
    <div class="card" style="background-color:grey">
        <h2><%= surveyQuestionResult %></h2>
        <% for (var surveyResult in allSurveyResults[surveyQuestionResult]){ %>
            <tr><%= surveyResult %> :  <%= allSurveyResults[surveyQuestionResult][surveyResult] %></tr>
        <% } %>  
      </div>        
    <% } %>  
 
    <!-- chart from https://www.chartjs.org/docs/latest/getting-started/ -->
    <script>
      //from https://stackoverflow.com/a/59136857
      let test ={}
      test = '<%- JSON.stringify(allSurveyResults) %>'; // test is now a valid js object

      console.log("test;"+ test)
     // let ff = JSON.stringify(allSurveyResults);
     //https://www.w3schools.com/js/js_json_parse.asp
      const obj = JSON.parse(test)
      console.log("ff o"+obj)
      let dataforCharts = [];
      let labelforCharts = []
      let tmpdata = []
      let tmplabels = []
      let questions = []
      for (let i in obj){
        questions.push(i)
        tmpdata = [];
        tmplabels = []
        console.log(i+"is it working??????");
        for (let j in obj[i]){
          tmpdata.push(obj[i][j])
          tmplabels.push(j)

          console.log("j is"+j+"   "+obj[i][j])
        }
        dataforCharts.push(tmpdata)
        labelforCharts.push(tmplabels)
        //i is the question itself
      }
for (let f in dataforCharts){
  console.log("is it workin"+labelforCharts[f]+"::::"+dataforCharts[f])
}
      console.log(test["How would you rate the overall appearance of the website?"]+"here>>>>")
      const labels = labelforCharts[0];
    //chart from https://www.chartjs.org/docs/latest/charts/bar.html
      const data = {
        labels: labels,
        datasets: [{
          label: questions[0],
          backgroundColor: [
      'rgba(255, 99, 132, 0.2)',
      'rgba(255, 159, 64, 0.2)',
      'rgba(255, 205, 86, 0.2)',
      'rgba(75, 192, 192, 0.2)',
      'rgba(54, 162, 235, 0.2)',
      'rgba(153, 102, 255, 0.2)',
      'rgba(201, 203, 207, 0.2)'
    ],
    borderColor: [
      'rgb(255, 99, 132)',
      'rgb(255, 159, 64)',
      'rgb(255, 205, 86)',
      'rgb(75, 192, 192)',
      'rgb(54, 162, 235)',
      'rgb(153, 102, 255)',
      'rgb(201, 203, 207)'
    ],
          data: dataforCharts[0],
        }]
      };
    
      const config = {
        type: 'bar',
        data: data,
        options: {}
      };
  
    </script>
   
    <div style="width:600px; height:600px">
      <canvas id="myChart"></canvas>
    </div>
    <script>
      const myChart = new Chart(
        document.getElementById('myChart'),
        config
      );
    </script>
 
    
 
    <script>
      // from https://stackoverflow.com/a/53172538 
        $(function () {
            var ctx = document.getElementById("question2").getContext('2d');
            var data = {
                datasets: [{
                    data: dataforCharts[1],
                    backgroundColor: [
      'rgba(255, 99, 132, 0.2)',
      'rgba(255, 159, 64, 0.2)',
      'rgba(255, 205, 86, 0.2)',
      'rgba(75, 192, 192, 0.2)',
      'rgba(54, 162, 235, 0.2)',
      'rgba(153, 102, 255, 0.2)',
      'rgba(201, 203, 207, 0.2)'
    ],
    borderColor: [
      'rgb(255, 99, 132)',
      'rgb(255, 159, 64)',
      'rgb(255, 205, 86)',
      'rgb(75, 192, 192)',
      'rgb(54, 162, 235)',
      'rgb(153, 102, 255)',
      'rgb(201, 203, 207)'
    ],
                }],
                labels: labelforCharts[1]
            };
            var myDoughnutChart = new Chart(ctx, {
                type: 'pie',
                data: data,
                options: {
                    responsive: false,
                    maintainAspectRatio: false,
                    legend: {
                        position: 'bottom',
                        labels: {
                            boxWidth: 12
                        }
                    }
                }
            });

            var ctx_2 = document.getElementById("question3").getContext('2d');
            var data_2 = {
                datasets: [{
                    data: dataforCharts[2],
                    backgroundColor: [
      'rgba(255, 99, 132, 0.2)',
      'rgba(255, 159, 64, 0.2)',
      'rgba(255, 205, 86, 0.2)',
      'rgba(75, 192, 192, 0.2)',
      'rgba(54, 162, 235, 0.2)',
      'rgba(153, 102, 255, 0.2)',
      'rgba(201, 203, 207, 0.2)'
    ],
    borderColor: [
      'rgb(255, 99, 132)',
      'rgb(255, 159, 64)',
      'rgb(255, 205, 86)',
      'rgb(75, 192, 192)',
      'rgb(54, 162, 235)',
      'rgb(153, 102, 255)',
      'rgb(201, 203, 207)'
    ],
                }],
                labels: labelforCharts[2]
            };
            var myDoughnutChart_2 = new Chart(ctx_2, {
                type: 'pie',
                data: data_2,
                options: {
                    responsive: false,
                    maintainAspectRatio: false,
                    legend: {
                        position: 'bottom',
                        labels: {
                            boxWidth: 12
                        }
                    }
                }
            });
        });

    </script>
</head>

<body>
  <div>
    <h>hi</h>
      <canvas id="question2" width="240px" height="240px"></canvas>
  </div>

  <div>
      <canvas id="question3" width="240px" height="240px"></canvas>
  </div>
  <div>
      <canvas id="question4" width="240px" height="240px"></canvas>
  </div>

  <div>
      <canvas id="question5" width="240px" height="240px"></canvas>
  </div>
     
   
</body>
</html>